#!/bin/bash

# Create directory to store data
mkdir -p pokemon_data

# Log file for errors
error_log="fetch_errors.log"
: > "$error_log"  # clear previous log

# List of Pokémon to fetch (lowercase)
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Loop through each Pokémon
for name in "${pokemon_list[@]}"; do
  echo "Fetching data for $name..."

  success=false
  attempts=0

  while [[ $attempts -lt 3 ]]; do
    ((attempts++))

    # Fetch data using curl
    curl -s --fail "https://pokeapi.co/api/v2/pokemon/$name" -o "pokemon_data/${name}.json"

    # Check if curl succeeded and file is non-empty
    if [[ $? -eq 0 && -s "pokemon_data/${name}.json" ]]; then
      echo "Saved data to pokemon_data/${name}.json ✅"
      success=true
      break
    else
      echo "Attempt $attempts failed for $name"
      sleep 2  # wait before retrying
    fi
  done

  if ! $success; then
    echo "❌ Failed to fetch data for $name after 3 attempts"
    echo "$name" >> "$error_log"
  fi

  sleep 1  # rate-limit delay
done

echo -e "\nFetching complete."

if [[ -s "$error_log" ]]; then
  echo "Some Pokémon failed to fetch. See $error_log for details."
else
  echo "All Pokémon data fetched successfully. ✅"
fi
