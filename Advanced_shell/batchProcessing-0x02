#!/bin/bash

# Create directory to store data
mkdir -p pokemon_data

# Error log file
error_log="fetch_errors.log"
: > "$error_log"

# List of Pokémon
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Loop through Pokémon
for name in "${pokemon_list[@]}"; do
  echo "Fetching data for $name..."

  success=false

  # Retry up to 3 times
  for attempt in 1 2 3; do
    curl -s --fail "https://pokeapi.co/api/v2/pokemon/$name" -o "pokemon_data/${name}.json"

    if [[ $? -eq 0 && -s "pokemon_data/${name}.json" ]]; then
      echo "Saved data to pokemon_data/${name}.json ✅"
      success=true
      break
    else
      echo "Attempt $attempt failed for $name"
      sleep 2
    fi
  done

  if ! $success; then
    echo "❌ Failed to fetch data for $name after 3 attempts"
    echo "$name" >> "$error_log"
  fi

  sleep 1
done

# Summary
echo -e "\nFetching complete."
if [[ -s "$error_log" ]]; then
  echo "Some Pokémon failed to fetch. See $error_log for details."
else
  echo "All Pokémon data fetched successfully. ✅"
fi
