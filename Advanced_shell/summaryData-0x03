#!/bin/bash

# Ensure required tools are installed
for tool in jq awk sed bc; do
  if ! command -v $tool >/dev/null; then
    echo "Error: $tool is not installed." >&2
    exit 1
  fi
done

# Output file
report_file="pokemon_report.csv"

# CSV Header
echo "Name,Height (m),Weight (kg)" > "$report_file"

# Process JSON files
for file in pokemon_data/*.json; do
  name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')  # capitalize using sed
  height=$(jq -r '.height' "$file")
  weight=$(jq -r '.weight' "$file")

  # Convert units
  height_m=$(echo "scale=2; $height / 10" | bc)
  weight_kg=$(echo "scale=2; $weight / 10" | bc)

  echo "$name,$height_m,$weight_kg" >> "$report_file"
done

echo -e "\nCSV Report generated at: $report_file"
cat "$report_file"

# Calculate and print averages using awk
awk -F',' 'NR > 1 {
  total_height += $2;
  total_weight += $3;
  count++;
}
END {
  avg_height = total_height / count;
  avg_weight = total_weight / count;

  # Use sed to remove trailing zeros
  printf "\nAverage Height: %.2f m\n", avg_height | "sed 's/\\.?0*$//'"
  printf "Average Weight: %.2f kg\n", avg_weight | "sed 's/\\.?0*$//'"
}' "$report_file"
